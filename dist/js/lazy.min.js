!function(e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():window.lazyload=e()}(function(){return lazyload=function(e){var t,r=this;for(t in r.options=e||{},r.defaults={elements:".lazy",srcAttr:"data-src",mediaAttr:"data-media",clearSrc:!1,clearMedia:!1},r.elements=[],r.currentPixelRatio={},r.imageObserver=null,r.resizeHandler={handleEvent:r.windowResizeEvent,ctx:r},r.defaults)void 0===r.options[t]&&(r.options[t]=r.defaults[t]);r.init()},lazyload.prototype.init=function(){var e=this;e.createImgLazyObject(),e.getPxRatio(),e.createObserver(),e.startObserve(),window.addEventListener("resize",e.resizeHandler)},lazyload.prototype.createImgLazyObject=function(e){for(var t=this,r=t.options,a=e||document.querySelectorAll(r.elements),i=/\n|\t|\s{2,}/gm,s=/\(max\-width.*?\)|\(min\-width.*?\)/g,o=/\{.*?\}/g,n={imgSet:/image-set\((.*?)\)/,pxRatio:/[0-9.]+x$/,src:/.*(?=\s[0-9.]+x$)/,split:/\,\s|\,/},l=0;l<a.length;l++){var c,d=a[l].getAttribute(r.mediaAttr),m=a[l].getAttribute(r.srcAttr),u=a[l].getAttribute("data-lazy-clear-media"),v=a[l].getAttribute("data-lazy-clear-src"),f=void 0;if(a[l].lazyObject={src:"PICTURE"===a[l].tagName?m:t.imgSrcParse(m,n),media:{},lazyTimer:null},d){c=(d=d.replace(i,"")).match(s),f=d.match(o);var y=a[l].lazyObject.media;y.length=c.length;for(var g=0;g<y.length;g++)y[c[g]]=t.imgSrcParse(f[g].slice(1,-1),n);!r.clearMedia&&"true"!=u||"false"==u||a[l].removeAttribute(r.mediaAttr)}!r.clearSrc&&"true"!=v||"false"==v||a[l].removeAttribute(r.srcAttr),t.elements.push(a[l]),"function"==typeof window.CustomEvent&&(v=new CustomEvent("lazyinit"),a[l].dispatchEvent(v))}},lazyload.prototype.imgSrcParse=function(e,t){if(-1===e.search("image-set"))return e;for(var r={},a=e.replace(t.imgSet,"$1").split(t.split),i=0;i<a.length;i++){var s=a[i].match(t.pxRatio)[0],o=a[i].match(t.src)[0];r[s]=o}return r},lazyload.prototype.getPxRatio=function(){for(var e,t,r=+window.devicePixelRatio.toFixed(1),a=1;a<10;a++)if(1===a){if(r<=a){e=a+"x",t=a;break}}else if(a-1<r&&r<=a){e=a+"x",t=a;break}this.currentPixelRatio.str=e,this.currentPixelRatio.num=t},lazyload.prototype.createObserver=function(){var r=this;r.imageObserver=new IntersectionObserver(function(e){e.forEach(function(e){var t;e.isIntersecting&&((e=(t=e.target).getAttribute("data-lazy-delay"))?t.lazyObject.lazyTimer=setTimeout(function(){r.setImg(t)},+e):r.setImg(t))})})},lazyload.prototype.startObserve=function(e){for(var t=e||this.elements,r=0;r<t.length;r++)this.imageObserver.observe(t[r])},lazyload.prototype.setImg=function(e){var t,r,a=this,i=e.lazyObject.src,s=e.lazyObject.media,o=e.tagName.toLowerCase(),n="";for(r in s)"length"!==r&&matchMedia(r).matches&&(t=r);if("picture"===o)for(var l=e.children,c=0,d=l.length;c<d;c++){var m=void 0,u=void 0;l[c].hasAttribute("src")?(m="src",u="data-src"):l[c].hasAttribute("srcset")&&(m="srcset",u="data-srcset"),l[c].setAttribute(m,l[c].getAttribute(u))}else{var v=t?s[t]:n?"":i;if("string"==typeof v)n=v;else{var f=v[a.currentPixelRatio.str];if(!f)for(var y=1;y<10;y++){var g=v[a.currentPixelRatio.num-y+"x"];if(g){f=g;break}}n=f}switch(o){case"img":e.src=n;break;case"header":case"section":case"footer":case"main":case"div":case"span":case"button":case"form":case"article":case"a":e.style.backgroundImage=n}}e.classList.add("lazyloaded"),"function"==typeof window.CustomEvent&&(o=new CustomEvent("lazyloaded"),e.dispatchEvent(o)),a.imageObserver.unobserve(e)},lazyload.prototype.windowResizeEvent=function(e){var t=this.ctx||this,r=t.elements;t.getPxRatio();for(var a=0;a<r.length;a++)clearTimeout(r[a].lazyObject.lazyTimer),t.imageObserver.unobserve(r[a]),t.imageObserver.observe(r[a])},lazyload.prototype.destroy=function(){var e=this;window.removeEventListener("resize",e.resizeHandler),e.imageObserver.disconnect();for(var t=0;t<e.elements.length;t++)clearTimeout(e.elements[t].lazyObject.lazyTimer),e.setImg(e.elements[t]),delete e.elements[t].lazyObject;e.elements=[],e.currentPixelRatio={},e.imageObserver=null},lazyload.prototype.refresh=function(){for(var e=this,t=document.querySelectorAll(e.options.elements),r=[],a=0;a<t.length;a++)t[a].lazyObject||r.push(t[a]);e.createImgLazyObject(r),e.startObserve(r),window.removeEventListener("resize",e.resizeHandler),window.addEventListener("resize",e.resizeHandler)},lazyload});