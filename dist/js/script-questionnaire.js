document.addEventListener("DOMContentLoaded",function(){var h,e,i,n,r,a,o,l,t,s,c,d,f,m,u,p,g,v,w,x,b,L;b=id("questionnaire-incomplete-section"),L=document.forms["questionnaire-form"],b&&L&&(h=".questionnaire-form__step",e=q(".questionnaire-incomplete-section__btn",b),q(".questionnaire-form__complete",L),i=q(".questionnaire-form__count-current",L),n=q(".questionnaire-form__back",L),r=q(".questionnaire-form__next",L),a=L.submit,o=q(".questionnaire-form__progress-line",L),l=qa(h+":not(.extra-step)",L),t=qa(h+".extra-step",L),s=l.length,t.length,c=!1,f=d=0,m={defaults:{min:"Значение не может быть меньше %min%",max:"Значение не может быть больше %max%",required:"Заполните поле"},"current-weight":{"weight-loss":"Текущий вес не может быть меньше желаемого веса","target-weight":"Текущий вес не может быть равен желаемому","weight-gain":"Текущий вес не может быть больше желаемого веса"},"target-weight":{"weight-loss":"Желаемый вес не может быть больше текущего веса","current-weight":"Желаемый вес не может быть равен текущему","weight-gain":"Жалемый вес не может быть меньше текущего веса"},height:{},age:{},"categories[]":{max:"Выберите максимум 5 пунктов"},"training-restrictions[]":{max:"Выберите максимум 3 пункта"},"milk-products[]":{required:"Выберите хоть что-то"},"meat-products[]":{required:"Выберите хоть что-то"},"fish-products[]":{required:"Выберите хоть что-то"},"cereals-products[]":{required:"Выберите хоть что-то"},"inventory[]":{required:"Выберите хоть что-то"}},u='<span class="questionnaire-form__error">%text%</span>',p=function(e,t,i){i=i||"add";var n=q(".questionnaire-form__error",e);n?"add"===i?n.textContent=t:e.removeChild(n):"add"===i&&e.insertAdjacentHTML("beforeend",u.replace("%text%",t))},g=function(){var e,t=q(h+":not(.hide)",L).getElementsByTagName("input"),i=0;for(e in m){var n=t[e],r=(m[e],void 0);if(n){if("checkbox"===n.type){if("categories[]"===e){var a=n.parentElement.parentElement;return!(5<qa("input:checked",a).length)||(r=m[e].max||m.defaults.required,p(a,r),!1)}if("training-restrictions[]"===e){var o=n.parentElement.parentElement;return!(3<qa("input:checked",o).length)||(r=m[e].max||m.defaults.required,p(o,r),!1)}for(var s=0,u=t.length;s<u;s++)if(t[s].checked)return!0;return r=m[e].required||m.defaults.required,p(n.parentElement.parentElement,r),!1}var l=n.parentElement,c=n.value,d=n.name,a=n.getAttribute("min"),o=n.getAttribute("max"),n=n.hasAttribute("required");if(!l.classList.contains("disabled"))if(!n||c)if(a&&+c<+a)r=m[e].min||m.defaults.min.replace("%min%",a),p(l,r);else if(o&&+o<+c)r=m[e].max||m.defaults.max.replace("%max%",o),p(l,r);else{if("weight-loss"===L.target.value){if("current-weight"===d){if(+c<+L["target-weight"].value){r=m[e]["weight-loss"],p(l,r);continue}if(c===L["target-weight"].value){r=m[e]["target-weight"],p(l,r);continue}}else if("target-weight"===d){if(+c>+L["current-weight"].value){r=m[e]["weight-loss"],p(l,r);continue}if(c===L["current-weight"].value){r=m[e]["current-weight"],p(l,r);continue}}}else if("weight-gain"===L.target.value)if("current-weight"===d){if(+c>+L["target-weight"].value){r=m[e]["weight-gain"],p(l,r);continue}if(c===L["target-weight"].value){r=m[e]["target-weight"],p(l,r);continue}}else if("target-weight"===d){if(+c<+L["current-weight"].value){r=m[e]["weight-gain"],p(l,r);continue}if(c===L["current-weight"].value){r=m[e]["current-weight"],p(l,r);continue}}p(l,"","remove"),i++}else r=m[e].required||m.defaults.required,p(l,r)}}if(0===i)for(var g=t.length-1;0<=g;g--)t[g].required||i++;return 2===f&&"weight-maintaining"===L.target.value&&i++,4<=i},v=function(){var e=q(h+":not(.hide)",L),t=qa("input",e);!function(){for(var e=qa(".questionnaire-form__error",L),t=e.length-1;0<=t;t--)e[t].parentElement.removeChild(e[t])}();for(var i=0,n=t.length;i<n;i++){var r=t[i].type;"radio"===r||"checkbox"===r?t[i].checked=!1:"text"!==r&&"number"!==r||(t[i].value="")}},w=function(e){q(h+":not(.hide)",L).classList.add("hide"),e.classList.remove("hide"),r.classList.toggle("hide",!e.classList.contains("with-next-button")),a.classList.toggle("hide",!e.classList.contains("with-final-button")),d<=0&&(d=1),i.textContent=f+1+"."+d,scrollToTarget("",".questionnaire-incomplete-section__title")},x=function(e){c=!1,"weight-maintaining"===L.target.value?(L["target-weight"].removeAttribute("required"),L["target-weight"].setAttribute("tabindex","-1")):(L["target-weight"].setAttribute("required",""),L["target-weight"].removeAttribute("tabindex"));var t=q(h+":not(.hide)",L);i.textContent=e+1,r.classList.toggle("hide",!l[e].classList.contains("with-next-button")),a.classList.toggle("hide",!l[e].classList.contains("with-final-button")),L["target-weight"].parentElement.classList.toggle("disabled",L["weight-maintaining"].checked),n.classList.toggle("disabled",0===e),t.classList.add("hide"),l[e].classList.remove("hide"),o.style.width=f/s*100+"%",v(),scrollToTarget("",".questionnaire-incomplete-section__title")},e.addEventListener("click",function(){b.classList.add("show-form"),L.classList.remove("hide")}),L.addEventListener("submit",function(e){e.preventDefault(),L.classList.add("loading"),a.blur();var t=new FormData(L),e=siteUrl+"/wp-admin/admin-ajax.php";t.append("action","questionnaire_send"),fetch(e,{method:"POST",body:t}).then(function(e){return e.ok?e.text():""}).then(function(e){0==e?errorPopup.openPopup():(e=JSON.parse(e),location.href=siteUrl+"/account")}).catch(function(e){errorPopup.openPopup()})}),n.addEventListener("click",function(){if(v(),c){var e,t,i=q(".extra-step:not(.hide)",L),n=qa(":checked",l[f]);if(i&&(e=i.getAttribute("data-question"),t=i.getAttribute("data-answer"),i.completed=!1),1<=d)for(var r=d-1;0<=r;r--)if(e!==n[r].name||t!==n[r].value){var a=q('.extra-step[data-question="'+n[r].name+'"][data-answer="'+n[r].value+'"]',L);if(a)return c=!0,w(a),void d--}d=0,x(f)}else{i=l[--f];if(i)for(var o=qa(":checked",i),s=o.length-1;0<=s;s--){var u=q('.extra-step[data-question="'+o[s].name+'"][data-answer="'+o[s].value+'"]',L);if(u)return c=!0,w(u),void d--}x(f)}}),r.addEventListener("click",function(){if(g()){for(var e,t=qa('input[type="checkbox"]:checked',l[f]),i=null,n=!1,r=d=5===f&&!c?0:d,a=t.length;r<a;r++)if(i=q('.extra-step[data-question="'+t[r].name+'"][data-answer="'+t[r].value+'"]',L),e=q(h+":not(.hide)",L),i&&!i.completed&&i!==e){n=!0;break}if(c){if(n)return c=!0,d++,w(i),void(i.completed=!0)}else if(n)return c=!0,d=0,void w(i);x(++f)}}),L.addEventListener("change",function(e){var t=e.target,i=t.type,n=t.value,e=t.name;if("radio"===i){e=q('.extra-step[data-question="'+e+'"][data-answer="'+n+'"]',L);if(e)return c=!0,d++,void w(e);x(++f)}else if("checkbox"===i){var i=t.parentElement.parentElement,r=qa('input:not([value="all"])',i);if("all"===n)for(var a=r.length-1;0<=a;a--)r[a].checked=t.checked;else{n=q('input[value="all"]',i),i=qa('input:checked:not([value="all"])',i);n&&(n.checked=i.length===r.length)}}}),L.addEventListener("keydown",function(e){13===e.keyCode&&(a.classList.contains("hide")&&e.preventDefault(),g()&&x(++f))})),errorPopup=new Popup(".error-popup",{closeButtons:".error-popup__close"})});