document.addEventListener("DOMContentLoaded",function(){function n(t){t.target.closest(".diet-plan__calendar")||(u.classList.remove("active"),document.removeEventListener("click",n))}var u,t,e,m,_,v,a,i,s,o;u=q(".diet-plan__calendar"),t=qa(".calendar-item",u),e=q(".diet-plan__calendar-nav",u),m=q(".diet-plan__list"),_=q(".diet-plan__day"),v=q(".diet-plan__date"),a=q(".diet-plan__calendar-btn"),i=qa(".event",u),s=u.getAttribute("data-today"),o=i[0],i=i[1],o=o.getAttribute("data-date").split(".").reverse(),i=i.getAttribute("data-date").split(".").reverse(),Date.prototype.addDays=function(t){var e=new Date(this.valueOf());return e.setDate(e.getDate()+t),e},function(t,e){for(var a=[],n=t;n<=e;)a.push(n),n=n.addDays(1);return a.map(function(t){return("0"+t.getDate()).slice(-2)+"."+("0"+(t.getMonth()+1)).slice(-2)+"."+t.getFullYear()})}(new Date(o[0],o[1]-1,o[2]),new Date(i[0],i[1]-1,i[2]).addDays(0)).forEach(function(t,e){t=q('[data-date="'+t+'"]',u);t.setAttribute("data-day",e),t.classList.add("available")}),1<t.length&&e.classList.remove("hide"),a.addEventListener("click",function(t){document.removeEventListener("click",n),u.classList.toggle("active");var e=q(".calendar-item.active",u),a=q(".today",u).closest(".calendar-item");e&&e.classList.remove("active"),a.classList.add("active"),setTimeout(function(){document.addEventListener("click",n)})}),u.addEventListener("click",function(t){var r,d,p,c,e,l=t.target;l.classList.contains("diet-plan__calendar-next")||l.classList.contains("diet-plan__calendar-prev")?(t=q(".calendar-item.active",u),e=q(".calendar-item:not(.active)",u),t.classList.remove("active"),e.classList.add("active")):l.classList.contains("calendar-day")&&l.classList.contains("available")&&(r=q(".today",u),d=l.getAttribute("data-date"),p=d.split("."),e="action=load_diet_plan&day_index="+(c=l.getAttribute("data-day")),u.classList.add("loading"),m.classList.add("loading"),fetch(siteUrl+"/wp-admin/admin-ajax.php",{method:"POST",body:e,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){return t.ok?t.text():""}).then(function(t){var e="",a=new Date(p[2],p[1]-1,p[0]),n=new Date,i=Date.parse(a),s=Date.parse(n),o=n.getDate(),n=a.getDate(),a=new Date(p[2],p[1]-1,0).getDate();i===s?e="сегодня, ":i<s?o-n==1&&(e="вчера, "):(o+1===n||a===o&&1===n)&&(e="завтра, "),m.innerHTML=t,_.textContent="День "+(+c+1),v.innerHTML='<span class="diet-plan__today">'+e+"</span>"+d,u.classList.remove("loading"),m.classList.remove("loading"),r.classList.remove("today"),l.classList.add("today")}).catch(function(t){errorPopup&&errorPopup.openPopup(),u.classList.remove("loading"),m.classList.remove("loading")}))}),m.addEventListener("click",function(t){var u,e,m=t.target;m.classList.contains("diet-plan__item-change")&&(m.blur(),m.setAttribute("tabindex",-1),e=+(u=m.closest(".diet-plan__item")).getAttribute("data-id"),e=(t=JSON.parse(m.getAttribute("data-replacement"))).indexOf(e),t="action=replace_dish&replacement_id="+(t[e+1]||t[0])+"&today="+s+"&dish_type="+u.getAttribute("data-type"),u.classList.add("loading"),fetch(siteUrl+"/wp-admin/admin-ajax.php",{method:"POST",body:t,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){return t.ok?t.text():""}).then(function(t){t=JSON.parse(t);var e,a=q(".diet-plan__item-recipe-text",u),n=q(".diet-plan__item-calories",u),i=q(".diet-plan__item-title",u),s=q(".products-cart-popup__table",productsCartPopup),o=q(".products-cart-hero"),r=q(".diet-plan__item-igredietns-list",u),d="",p="",c=Object.assign(t.cart.top,t.cart.bottom);for(e in c){var l="";c[e].number&&(l+=c[e].number+" "+c[e].label),p+='<div class="products-cart-popup__tr">\n                <span class="products-cart-popup__td">'+e+'</span>\n                <span class="products-cart-popup__td">'+l+"</span>\n              </div>"}o.classList.add("attention"),s.innerHTML=p,t.item.ingredients.forEach(function(t){d+='<li class="diet-plan__item-igredietns-li">'+t.title,t.number&&(d+=" ("+t.number+" "+t.units+")"),d+="</li>"}),t.item.text?(a.innerHTML=t.item.text,u.classList.remove("no-recipe")):u.classList.add("no-recipe"),n.innerHTML="Калорийность "+t.item.calories+" ккал",i.innerHTML=t.item.title,r.innerHTML=d,u.classList.remove("loading"),m.removeAttribute("tabindex"),u.setAttribute("data-id",t.item.id)}).catch(function(t){m.removeAttribute("tabindex"),errorPopup.openPopup(),u.classList.remove("loading")}))}),allowedProductsPopup=new Popup(".allowed-products-popup",{openButtons:".allowed-popup-open",closeButtons:".allowed-products-popup__close"}),nutritionRulesPopup=new Popup(".nutrition-rules-popup",{openButtons:".nutrition-rules-popup-open",closeButtons:".nutrition-rules-popup__close"}),productsCartPopup=new Popup(".products-cart-popup",{openButtons:".products-cart-popup-open",closeButtons:".products-cart-popup__close"}),productsCartPopup.addEventListener("popupbeforeopen",function(){q(".products-cart-hero").classList.remove("attention")}),errorPopup=new Popup(".error-popup",{closeButtons:".error-popup__close"})});