document.addEventListener("DOMContentLoaded",function(){function i(t){for(var e=0,a=t.length;e<a;e++)t[e].setAttribute("data-day",e)}function n(t){t.target.closest(".diet-plan__calendar")||(d.classList.remove("active"),document.removeEventListener("click",n))}var d,t,e,p,l,u,a,s,o;d=q(".diet-plan__calendar"),t=qa(".calendar-item",d),e=q(".diet-plan__calendar-nav",d),p=q(".diet-plan__list"),l=q(".diet-plan__day"),u=q(".diet-plan__date"),a=q(".diet-plan__calendar-btn"),s=qa(".event",d),o=d.getAttribute("data-today"),s.forEach(function(t,e){var a=t.parentElement,n=a.nextElementSibling,t=a.previousElementSibling;i(a.children),a.classList.add("active-week"),0===e&&n&&(n.classList.add("active-week"),n.setAttribute("data-week",2),i(n.children)),1===e&&t&&(t.classList.add("active-week"),t.setAttribute("data-week",2),i(t.children))}),s[0]&&s[0].parentElement.setAttribute("data-week",1),s[1]&&s[1].parentElement.setAttribute("data-week",3),1<t.length&&e.classList.remove("hide"),a.addEventListener("click",function(t){var e,a,t=t.target;t.classList.contains("diet-plan__calendar-next")||t.classList.contains("diet-plan__calendar-prev")?(e=q(".calendar-item.active",d),a=q(".calendar-item:not(.active)",d),e.classList.remove("active"),a.classList.add("active")):(d.classList.add("active"),e=q(".calendar-item.active",d),a=q(".today",d).closest(".calendar-item"),e&&e.classList.remove("active"),a.classList.add("active"),setTimeout(function(){document.addEventListener("click",n)}))}),p.addEventListener("click",function(t){var u,e=t.target;e.classList.contains("diet-plan__item-change")&&(t=+(u=e.closest(".diet-plan__item")).getAttribute("data-id"),t=(e=JSON.parse(e.getAttribute("data-replacement"))).indexOf(t),e="action=replace_dish&replacement_id="+(e[t+1]||e[0])+"&today="+o+"&dish_type="+u.getAttribute("data-type"),u.classList.add("loading"),fetch(siteUrl+"/wp-admin/admin-ajax.php",{method:"POST",body:e,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){return t.ok?t.text():""}).then(function(t){t=JSON.parse(t);var e,a=q(".diet-plan__item-recipe-text",u),n=q(".diet-plan__item-calories",u),i=q(".diet-plan__item-title",u),s=q(".products-cart-popup__table",productsCartPopup),o=q(".products-cart-hero"),c=q(".diet-plan__item-igredietns-list",u),r="",d="",p=Object.assign(t.cart.top,t.cart.bottom);for(e in p){var l="";p[e].number&&(l+=p[e].number+" "+p[e].label),d+='<div class="products-cart-popup__tr">\n                <span class="products-cart-popup__td">'+e+'</span>\n                <span class="products-cart-popup__td">'+l+"</span>\n              </div>"}o.classList.add("attention"),s.innerHTML=d,t.item.ingredients.forEach(function(t){r+='<li class="diet-plan__item-igredietns-li">'+t.title,t.number&&(r+=" ("+t.number+" "+t.units+")"),r+="</li>"}),t.item.text?(a.innerHTML=t.item.text,u.classList.remove("no-recipe")):u.classList.add("no-recipe"),n.innerHTML="Калорийность "+t.item.calories+" ккал",i.innerHTML=t.item.title,c.innerHTML=r,u.classList.remove("loading"),u.setAttribute("data-id",t.item.id)}).catch(function(t){errorPopup.openPopup(),u.classList.remove("loading")}))}),d.addEventListener("click",function(t){var i,s,o,c,r=t.target;r.classList.contains("calendar-day")&&r.parentElement.classList.contains("active-week")&&(i=q(".today",d),s=r.getAttribute("data-date").slice(-10),o=r.parentElement.getAttribute("data-week"),c=r.getAttribute("data-day"),t="action=load_diet_plan&day="+r.textContent+"&week="+o+"&day_index="+c,d.classList.add("loading"),fetch(siteUrl+"/wp-admin/admin-ajax.php",{method:"POST",body:t,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){return t.ok?t.text():""}).then(function(t){var e="",a=new Date(s.slice(-4),s.slice(3,5),s.slice(0,2)).getDate(),n=(new Date).getDate();a===n?e="сегодня, ":n-a==1?e="вчера, ":n+1===a&&(e="завтра, "),p.innerHTML=t,l.textContent="День "+(+c+1+7*(o-1)),u.innerHTML='<span class="diet-plan__today">'+e+"</span>"+r.getAttribute("data-date").slice(-10),d.classList.remove("loading"),i.classList.remove("today"),r.classList.add("today")}).catch(function(t){}))}),allowedProductsPopup=new Popup(".allowed-products-popup",{openButtons:".allowed-popup-open",closeButtons:".allowed-products-popup__close"}),nutritionRulesPopup=new Popup(".nutrition-rules-popup",{openButtons:".nutrition-rules-popup-open",closeButtons:".nutrition-rules-popup__close"}),productsCartPopup=new Popup(".products-cart-popup",{openButtons:".products-cart-popup-open",closeButtons:".products-cart-popup__close"}),productsCartPopup.addEventListener("popupbeforeopen",function(){q(".products-cart-hero").classList.remove("attention")}),errorPopup=new Popup(".error-popup",{closeButtons:".error-popup__close"})});