document.addEventListener("DOMContentLoaded",function(){function i(t){for(var e=0,a=t.length;e<a;e++)t[e].setAttribute("data-day",e)}function n(t){t.target.closest(".diet-plan__calendar")||(r.classList.remove("active"),document.removeEventListener("click",n))}var r,t,e,l,p,u,a,s,c;r=q(".diet-plan__calendar"),t=qa(".calendar-item",r),e=q(".diet-plan__calendar-nav",r),l=q(".diet-plan__list"),p=q(".diet-plan__day"),u=q(".diet-plan__date"),a=q(".diet-plan__calendar-btn"),s=qa(".event",r),c=r.getAttribute("data-today"),s.forEach(function(t,e){var a=t.parentElement,n=a.nextElementSibling,t=a.previousElementSibling;i(a.children),a.classList.add("active-week"),0===e&&n&&(n.classList.add("active-week"),n.setAttribute("data-week",2),i(n.children)),1===e&&t&&(t.classList.add("active-week"),t.setAttribute("data-week",2),i(t.children))}),s[0]&&s[0].parentElement.setAttribute("data-week",1),s[1]&&s[1].parentElement.setAttribute("data-week",3),1<t.length&&e.classList.remove("hide"),a.addEventListener("click",function(t){var e,a,t=t.target;t.classList.contains("diet-plan__calendar-next")||t.classList.contains("diet-plan__calendar-prev")?(e=q(".calendar-item.active",r),a=q(".calendar-item:not(.active)",r),e.classList.remove("active"),a.classList.add("active")):(r.classList.add("active"),e=q(".calendar-item.active",r),a=q(".today",r).closest(".calendar-item"),e&&e.classList.remove("active"),a.classList.add("active"),setTimeout(function(){document.addEventListener("click",n)}))}),l.addEventListener("click",function(t){var p,e=t.target;e.classList.contains("diet-plan__item-change")&&(t=+(p=e.closest(".diet-plan__item")).getAttribute("data-id"),t=(e=JSON.parse(e.getAttribute("data-replacement"))).indexOf(t),e="action=replace_dish&replacement_id="+(e[t+1]||e[0])+"&today="+c+"&dish_type="+p.getAttribute("data-type"),p.classList.add("loading"),fetch(siteUrl+"/wp-admin/admin-ajax.php",{method:"POST",body:e,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){return t.ok?t.text():""}).then(function(t){t=JSON.parse(t);var e,a=q(".diet-plan__item-recipe-text",p),n=q(".diet-plan__item-calories",p),i=q(".diet-plan__item-title",p),s=q(".products-cart-popup__table",productsCartPopup),c=q(".products-cart-hero"),d=q(".diet-plan__item-igredietns-list",p),o="",r="";for(e in t.cart){var l="";t.cart[e].number&&(l+=t.cart[e].number+" "+t.cart[e].label),r+='<div class="products-cart-popup__tr">\n                <span class="products-cart-popup__td">'+e+'</span>\n                <span class="products-cart-popup__td">'+l+"</span>\n              </div>"}c.classList.add("attention"),s.innerHTML=r,t.item.ingredients.forEach(function(t){o+='<li class="diet-plan__item-igredietns-li">'+t.title,t.number&&(o+=" ("+t.number+" "+t.units+")"),o+="</li>"}),t.item.text?(a.innerHTML=t.item.text,p.classList.remove("no-recipe")):p.classList.add("no-recipe"),n.innerHTML="Калорийность "+t.item.calories+" ккал",i.innerHTML=t.item.title,d.innerHTML=o,p.classList.remove("loading"),p.setAttribute("data-id",t.item.id)}).catch(function(t){}))}),r.addEventListener("click",function(t){var i,s,c,d,o=t.target;o.classList.contains("calendar-day")&&o.parentElement.classList.contains("active-week")&&(i=q(".today",r),s=o.getAttribute("data-date").slice(-10),c=o.parentElement.getAttribute("data-week"),d=o.getAttribute("data-day"),t="action=load_diet_plan&day="+o.textContent+"&week="+c+"&day_index="+d,r.classList.add("loading"),fetch(siteUrl+"/wp-admin/admin-ajax.php",{method:"POST",body:t,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){return t.ok?t.text():""}).then(function(t){var e="",a=new Date(s.slice(-4),s.slice(3,5),s.slice(0,2)).getDate(),n=(new Date).getDate();a===n?e="сегодня, ":n-a==1?e="вчера, ":n+1===a&&(e="завтра, "),l.innerHTML=t,p.textContent="День "+(+d+1+7*(c-1)),u.innerHTML='<span class="diet-plan__today">'+e+"</span>"+o.getAttribute("data-date").slice(-10),r.classList.remove("loading"),i.classList.remove("today"),o.classList.add("today")}).catch(function(t){}))}),allowedProductsPopup=new Popup(".allowed-products-popup",{openButtons:".allowed-popup-open",closeButtons:".allowed-products-popup__close"}),nutritionRulesPopup=new Popup(".nutrition-rules-popup",{openButtons:".nutrition-rules-popup-open",closeButtons:".nutrition-rules-popup__close"}),productsCartPopup=new Popup(".products-cart-popup",{openButtons:".products-cart-popup-open",closeButtons:".products-cart-popup__close"}),productsCartPopup.addEventListener("popupbeforeopen",function(){q(".products-cart-hero").classList.remove("attention")})});